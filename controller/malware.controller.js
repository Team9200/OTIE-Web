import Malware from '../database/models/malware';

function get(req, res) {

	Malware.find({}, function(err, data){

    	if(err){
    	
    		res.json({
            	success: false,
            	message: 'Query error'
        	});
    	}
    	
    	console.log(data);	// 결과

    });

}

function search(req, res) {

    var query = req.body.query; // get query
    var regex = /#\w+|@\w+/g;	
	var result = query.match(regex);	// extract type and data

	if(result[0].slice(0,1) === "#"){		// tag 

		var data=result[0].slice(1)

		Malware.find({tag_name_etc:{$elemMatch: { "tag":data}}}, function(err, data){
	    	
	    	if(err){
	    	
	    		res.json({
	            	success: false,
	            	message: 'Query error'
	        	});
	    	}

    		console.log(data);		// 결과

 	    });

	}
    else if(result[0].slice(0,1) === "@"){	// hash

		var data=result[0].slice(1)

		if(data.length === 32){

			Malware.find({"md5":data}, function(err, data){

		    	if(err){
		    	
		    		res.json({
		            	success: false,
		            	message: 'Query error'
		        	});
		    	}
		    	console.log(data);	// 결과

		    });
		
		}
		else if(data.length === 40){

			Malware.find({"sha1":data}, function(err, data){

		    	if(err){
		    	
		    		res.json({
		            	success: false,
		            	message: 'Query error'
		        	});
		    	}

		    	console.log(data);	// 결과

		    });

		}
		else if(data.length === 64){

			Malware.find({"sha256":data}, function(err, data){
		    	
		    	if(err){
		    	
		    		res.json({
		            	success: false,
		            	message: 'Query error'
		        	});

		    	}

		    	console.log(data);	// 결과

		    });

		}

	}
	else{
    	
		res.json({
        	success: false,
        	message: 'Query error'
    	});

	}

}
export default {
    get,
    search
};
