import Malware from '../database/models/malware';

function get(req, res) {
	Malware.find({}, function (err, data) {
		if (err) return res.json({
			success: false,
			message: 'Query error'
		});

		return res.json({
			success: true,
			message: data
		});
	});
}

function search(req, res) {
	var query = req.query.query; // get query
	var type = req.query.type; // get type

	if (type === "tag") { // tag \
		Malware.find({
			tag_name_etc: {
				$elemMatch: {
					"tag": query
				}
			}
		}, function (err, data) {
			if (err) {
				return res.json({
					success: false,
					message: 'Query error'
				});
			} else {
				return res.json({
					success: true,
					message: data
				});
			}
		});

	} else if (type === "hash") { // hash
		if (query.length === 32) {
			Malware.find({
				"md5": query
			}, function (err, data) {
				if (err) {
					return res.json({
						success: false,
						message: 'Query error'
					});
				} else {
					return res.json({
						success: true,
						message: data
					});
				}
			});
		} else if (query.length === 40) {
			Malware.find({
				"sha1": query
			}, function (err, data) {
				if (err) {
					return res.json({
						success: false,
						message: 'Query error'
					});
				} else {
					return res.json({
						success: true,
						message: data
					});
				}
			});

		} else if (query.length === 64) {
			Malware.find({
				"sha256": query
			}, function (err, data) {
				if (err) {
					return res.json({
						success: false,
						message: 'Query error'
					});
				} else {
					return res.json({
						success: true,
						message: data
					});
				}
			});

		}

	} else if (type === "col") {
		Malware.find({
			"collector": query
		}, function (err, data) {
			if (err) {
				return res.json({
					success: false,
					message: 'Query error'
				});
			} else {
				return res.json({
					success: true,
					message: data
				});
			}
		});
	} else if (type === "ana") {
		Malware.find({
			"analyzer": query
		}, function (err, data) {
			if (err) {
				return res.json({
					success: false,
					message: 'Query error'
				});
			} else {
				return res.json({
					success: true,
					message: data
				});
			}
		});

	} else {
		return res.json({
			success: false,
			message: 'Query error'
		});
	}
}

export default {
	get,
	search
};