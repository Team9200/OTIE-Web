<template>
    <v-container v-if="permlink.length != 0">
        <v-card style="overflow-y: auto;">
            <v-card-title>
                <h3>{{ malware.sha256 }}</h3>
            </v-card-title>
            <v-card-text>
                <div class="my-text">md5: {{ malware.md5 }}</div>
                <v-divider></v-divider>
                <div class="my-text">sha1: {{ malware.sha1 }}</div>
                <v-divider></v-divider>
                <div class="my-text">파일 타입: {{ malware.filetype }}</div>
                <v-divider></v-divider>
                <div class="my-text">첫 수집된 날짜: {{ malware.first_seen }}</div>
                <v-divider></v-divider>
                <div class="my-text">태그:&nbsp;<v-chip v-for="(tag, i) in malware.tag_name_etc" :key="i" label>{{
                        tag.tag }}</v-chip>
                </div>
                <v-divider></v-divider>
                <div class="my-text">분석가: {{ malware.ausername }}</div>
                <v-divider></v-divider>
                <div class="my-text">수집가: {{ malware.cusername }}</div>
                <v-divider></v-divider>
            </v-card-text>
        </v-card>
        <v-btn @click="$router.push(`/post/${permlink}`)" style="color: white;" color="green">Return Post
            ({{permlink}})</v-btn>
    </v-container>
</template>

<script>
    import {
        APIService
    } from '../../api/APIService'
    const apiService = new APIService()

    export default {
        name: 'malware-view',
        data: () => ({
            malware: {},
            permlink: ''
        }),
        methods: {
            getMalware(hash) {
                apiService.getMalware(hash)
                    .then(async (response) => {
                        this.malware = response.message.body
                        this.malware.ausername = await apiService.searchUser(response.message.publickey).then((user)=>{

                                if(user.message.length == 0){
                                    return response.message.publickey;
                                }
                                return user.message[0].username;

                            });
                        this.malware.cusername = await apiService.searchUser(response.message.body.collector).then((user)=>{

                                console.log("user",user.message);
                                if(user.message.length == 0){

                                    return response.message.body.collector;

                                }
                                return user.message[0].username;

                            });
                        console.log(this.malware)
                        this.permlink = response.message.permlink
                    })
                    .catch(err => {
                        if (err) throw err
                    })
            },
        },
        mounted() {
            this.getMalware(this.$route.params.hash)
        }
    }
</script>

<style>

</style>